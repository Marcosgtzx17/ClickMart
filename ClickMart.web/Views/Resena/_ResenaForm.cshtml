@model ClickMart.web.DTOs.ResenaDTOs.ResenaFormVM
@{
    // Admin puede elegir usuario en CREATE. En EDIT siempre queda bloqueado para todos.
    var isAdmin = User.IsInRole("Admin") || User.IsInRole("Administrador");
}

<div class="mb-3">
    <label asp-for="UsuarioId" class="form-label">Usuario</label>

    @* Si es EDIT (ResenaId tiene valor) → BLOQUEADO para todos *@
    @if (Model.ResenaId.HasValue)
    {
        <input type="hidden" asp-for="UsuarioId" />
        <input class="form-control mb-2" value="@(Model.UsuarioNombre ?? Model.UsuarioId.ToString())" disabled />
        @if (!string.IsNullOrWhiteSpace(Model.UsuarioEmail))
        {
            <input class="form-control" value="@Model.UsuarioEmail" disabled />
        }
    }
    else
    {
        @* CREATE *@
        @if (isAdmin)
        {
            <select asp-for="UsuarioId" class="form-select" asp-items="Model.Usuarios">
                <option value="">-- Selecciona --</option>
            </select>
        }
        else
        {
            @* No admin: autocompletar email y pre-llenar UsuarioId (hidden) *@
            <input type="hidden" asp-for="UsuarioId" />
            <input class="form-control" value="@Model.UsuarioEmail" disabled />
        }
    }

    <span asp-validation-for="UsuarioId" class="text-danger"></span>
</div>

<div class="mb-3">
    <label asp-for="ProductoId" class="form-label">Producto</label>
    <select asp-for="ProductoId" class="form-select" asp-items="Model.Productos">
        <option value="">-- Selecciona --</option>
    </select>
    <span asp-validation-for="ProductoId" class="text-danger"></span>
</div>

<div class="mb-3">
    <label asp-for="Calificacion" class="form-label">Calificación</label>

    <!-- Hidden real field (para el model binding) -->
    <input asp-for="Calificacion" type="hidden" id="Calificacion" />

    <!-- Widget de estrellas -->
    <div class="star-input" data-input-id="Calificacion" role="radiogroup" aria-label="Calificación (1 a 5)">
        <button type="button" class="star" data-value="1" role="radio" aria-label="1 estrella" aria-checked="false">★</button>
        <button type="button" class="star" data-value="2" role="radio" aria-label="2 estrellas" aria-checked="false">★</button>
        <button type="button" class="star" data-value="3" role="radio" aria-label="3 estrellas" aria-checked="false">★</button>
        <button type="button" class="star" data-value="4" role="radio" aria-label="4 estrellas" aria-checked="false">★</button>
        <button type="button" class="star" data-value="5" role="radio" aria-label="5 estrellas" aria-checked="false">★</button>
    </div>

    <small class="text-muted">Usa clic o flechas del teclado (←/→) para ajustar.</small>
    <span asp-validation-for="Calificacion" class="text-danger"></span>
</div>

<div class="mb-3">
    <label asp-for="Comentario" class="form-label">Comentario</label>
    <textarea asp-for="Comentario" class="form-control" rows="3"></textarea>
    <span asp-validation-for="Comentario" class="text-danger"></span>
</div>

<div class="mb-3">
    <label asp-for="FechaResena" class="form-label">Fecha</label>
    <input asp-for="FechaResena" class="form-control" type="datetime-local" />
    <span asp-validation-for="FechaResena" class="text-danger"></span>
</div>