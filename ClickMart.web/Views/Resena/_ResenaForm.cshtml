@model ClickMart.web.DTOs.ResenaDTOs.ResenaFormVM

@{
    // ==== Cálculos previos (igual que tenías) ====
    var displayUser = !string.IsNullOrWhiteSpace(Model.UsuarioEmail)
        ? Model.UsuarioEmail
        : (!string.IsNullOrWhiteSpace(Model.UsuarioNombre)
            ? Model.UsuarioNombre
            : Model.UsuarioId.ToString());

    var lockProduct = Model.ResenaId.HasValue || (Model.ProductoId > 0);

    string productName = string.Empty;
    if (lockProduct)
    {
        var sel = Model.Productos?.FirstOrDefault(p => p.Value == Model.ProductoId.ToString());
        productName = sel?.Text ?? $"Producto {Model.ProductoId}";
    }
}

<!-- ====== FORM GRID (match visual del resto) ====== -->
<div class="row g-3">

    <!-- Usuario (readonly) -->
    <div class="col-12 col-md-6">
        <label asp-for="UsuarioId" class="form-label form-label-ux">Usuario</label>
        <input type="hidden" asp-for="UsuarioId" />
        <input class="form-control" value="@displayUser" disabled />
        <span asp-validation-for="UsuarioId" class="invalid-feedback d-block"></span>
    </div>

    <!-- Producto (readonly si viene bloqueado) -->
    <div class="col-12 col-md-6">
        <label asp-for="ProductoId" class="form-label form-label-ux">Producto</label>
        @if (lockProduct)
        {
            <input type="hidden" asp-for="ProductoId" />
            <input class="form-control" value="@productName" disabled />
        }
        else
        {
            <select asp-for="ProductoId" class="form-select" asp-items="Model.Productos">
                <option value="">-- Selecciona --</option>
            </select>
        }
        <span asp-validation-for="ProductoId" class="invalid-feedback d-block"></span>
    </div>

    <!-- Calificación (estrellas) -->
    <div class="col-12 col-md-6">
        <label asp-for="Calificacion" class="form-label form-label-ux">Calificación</label>
        <!-- Campo real para el model binding -->
        <input asp-for="Calificacion" type="hidden" id="Calificacion" />

        <!-- Widget de estrellas (usa tu stars.js / stars.css) -->
        <div class="star-input border rounded-3 p-2 px-3" data-input-id="Calificacion"
             role="radiogroup" aria-label="Calificación (1 a 5)">
            <button type="button" class="star" data-value="1" role="radio" aria-label="1 estrella" aria-checked="false">★</button>
            <button type="button" class="star" data-value="2" role="radio" aria-label="2 estrellas" aria-checked="false">★</button>
            <button type="button" class="star" data-value="3" role="radio" aria-label="3 estrellas" aria-checked="false">★</button>
            <button type="button" class="star" data-value="4" role="radio" aria-label="4 estrellas" aria-checked="false">★</button>
            <button type="button" class="star" data-value="5" role="radio" aria-label="5 estrellas" aria-checked="false">★</button>
        </div>
        <small class="text-muted">Usa clic o flechas del teclado (←/→) para ajustar.</small>
        <span asp-validation-for="Calificacion" class="invalid-feedback d-block"></span>
    </div>

    <!-- Fecha -->
    <div class="col-12 col-md-6">
        <label asp-for="FechaResena" class="form-label form-label-ux">Fecha</label>
        <input asp-for="FechaResena" class="form-control" type="datetime-local" />
        <span asp-validation-for="FechaResena" class="invalid-feedback d-block"></span>
    </div>

    <!-- Comentario -->
    <div class="col-12">
        <label asp-for="Comentario" class="form-label form-label-ux">Comentario</label>
        <textarea asp-for="Comentario" class="form-control" rows="4" placeholder="Comparte tu experiencia..."></textarea>
        <span asp-validation-for="Comentario" class="invalid-feedback d-block"></span>
    </div>

</div>
